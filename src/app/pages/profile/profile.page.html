<ion-header>
  <ion-toolbar>
    <ion-title>
      <ion-icon name="person-circle-outline" slot="start"></ion-icon>
      Mi Perfil
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        Cerrar Sesión
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [class.ion-padding]="true">
  <ng-container *ngIf="!loading; else loadingTpl">
    <!-- Información del usuario -->
    <ion-item>
      <ion-label>
        <h2>ID de Usuario:</h2>
        <p>{{ userId }}</p>
        <h2>Perfil:</h2>
        <p>{{ perfil }}</p>
      </ion-label>
    </ion-item>

    <!-- Mis Tags -->
    <ion-list>
      <ion-item-divider>
        <ion-label>
          <ion-icon name="star-outline" slot="start"></ion-icon>
          Mis Tags
        </ion-label>
      </ion-item-divider>

      <ion-item *ngFor="let tag of myTags">
        <ion-label>
          <h3>Famoso: {{ tag.famousPersonId?.nombre || tag.famousPersonId }}</h3>
          <p>Sitio: {{ tag.siteId?.nombre || tag.siteId }}</p>
          <p>Fecha: {{ tag.tagDate | date:'short' }}</p>
          <ion-text *ngIf="tag.photoUrl">
            <p>Foto:</p>
            <img [src]="URL_Back + tag.photoUrl" style="width: 100px; height: auto; margin-top: 4px;" />
          </ion-text>
        </ion-label>
      </ion-item>
      <ion-item *ngIf="myTags.length === 0">
        <ion-label>
          No tienes tags registrados aún.
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Mis Favoritos (placeholder) -->
    <ion-list>
      <ion-item-divider>
        <ion-label>
          <ion-icon name="bookmark-outline" slot="start"></ion-icon>
          Mis Favoritos
        </ion-label>
      </ion-item-divider>

      <ion-item>
        <ion-label>
          Aún no tienes favoritos.  
          <!-- Si implementas un endpoint de favoritos, reemplaza este bloque -->
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Consulta 4: Usuarios con más tags -->
    <ion-list>
      <ion-item-divider>
        <ion-label>
          Top Usuarios con Más Tags
        </ion-label>
      </ion-item-divider>

      <ion-item *ngFor="let u of topUsersWithTags">
        <ion-label>
          <h3>{{ u.userName }}</h3>
          <p>Tags: {{ u.tagCount }}</p>
        </ion-label>
      </ion-item>
      <ion-item *ngIf="topUsersWithTags.length === 0">
        <ion-label>
          No hay datos para mostrar.
        </ion-label>
      </ion-item>
    </ion-list>
  </ng-container>

  <ng-template #loadingTpl>
    <ion-text>
      <p>Cargando perfil…</p>
    </ion-text>
  </ng-template>
</ion-content>
